<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Planificador Diario de Clientes</title>
  <style>
    :root{
      --bg:#0b0c0e; --card:#121419; --ink:#eaeef3; --muted:#aab3c2; --accent:#5ee6a5; --line:#232731;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial}
    h1{font-size:clamp(1.2rem,2.8vw,1.8rem);margin:0}
    .wrap{max-width:1050px;margin:auto;padding:22px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .grow{flex:1}
    input,textarea,button,.pill,select{border:1px solid var(--line);background:#0e1015;color:var(--ink);padding:12px 14px;border-radius:12px}
    input[type="text"],input[type="search"],textarea{width:100%}
    input.lg{font-size:1.05rem;padding:14px 16px}
    textarea{min-height:120px;resize:vertical}
    button{cursor:pointer}
    .toolbar{gap:8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px;margin-top:14px}
    .item{display:flex;gap:10px;align-items:flex-start;padding:10px;border:1px solid var(--line);border-radius:12px}
    .item input[type="checkbox"]{transform:scale(1.25);margin-top:3px}
    .muted{color:var(--muted)}
    .tabs{display:flex;gap:8px;margin-bottom:14px}
    .pill{user-select:none}
    .pill.active{outline:2px solid var(--accent);}
    .split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .hidden{display:none}
    .foot{display:flex;justify-content:space-between;align-items:center;margin-top:10px;color:var(--muted);font-size:13px}
    .badge{border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-size:12px}
    .hint{font-size:13px;color:var(--muted)}
    .searchWrap{display:flex;gap:8px;align-items:center;min-width:320px}
    .searchWrap button{padding:10px 12px}
    details{border:1px solid var(--line);border-radius:12px;padding:10px;background:#0e1015}
    details+details{margin-top:10px}
    summary{cursor:pointer;font-weight:700}
    @media (max-width:860px){.split{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row" style="margin-bottom:16px">
      <h1>Planificador diario de clientes</h1>
      <span class="badge" id="version">v1.1</span>
      <div class="grow"></div>
    </div>

    <div class="card">
      <div class="tabs">
        <div class="pill active" data-tab="plan">üóìÔ∏è Plan diario</div>
        <div class="pill" data-tab="rutas">üì¶ Rutas predefinidas</div>
        <div class="pill" data-tab="clientes">üë• Clientes</div>
        <div class="pill" data-tab="ayuda">‚ùì Ayuda</div>
      </div>

      <!-- PLAN DIARIO -->
      <section id="tab-plan">
        <div class="row toolbar">
          <label>
            <span class="muted">Fecha</span><br>
            <input type="date" id="fecha" />
          </label>
          <button id="hoy">Hoy</button>

          <div class="grow"></div>

          <div class="searchWrap grow" title="Buscar y limpiar con la X">
            <div class="grow">
              <span class="muted">Buscar cliente</span><br>
              <input type="search" class="lg" id="buscador" placeholder="Escribe para filtrar‚Ä¶" />
            </div>
            <button id="clearSearch" title="Borrar b√∫squeda">‚úï</button>
          </div>

          <label style="display:flex;align-items:center;gap:8px">
            <input type="checkbox" id="toggleAll"> Seleccionar todos
          </label>

          <button id="guardar">Guardar d√≠a</button>
          <button id="vaciar">Vaciar d√≠a</button>
          <button id="imprimir">Imprimir</button>
        </div>

        <div class="foot"><span class="muted">Clientes visibles: <span id="count"></span></span><span class="muted">Los datos se guardan en este navegador.</span></div>
        <div id="lista" class="grid" aria-live="polite"></div>
      </section>

      <!-- RUTAS PREDEFINIDAS -->
      <section id="tab-rutas" class="hidden">
        <h3>Rutas predefinidas</h3>
        <p class="hint">Edita las rutas R-1 a R-5. Escribe un cliente por l√≠nea y pulsa <em>Guardar</em>. Puedes <strong>Aplicar</strong> una ruta al d√≠a actual.</p>
        <div id="rutasBox"></div>
      </section>

      <!-- CLIENTES -->
      <section id="tab-clientes" class="hidden">
        <div class="split">
          <div>
            <h3>Listado actual</h3>
            <p class="hint">Puedes a√±adir o borrar clientes. Los cambios se guardan en este navegador.</p>
            <div class="row">
              <input class="grow" type="text" id="nuevoCliente" placeholder="Nombre del nuevo cliente" />
              <button id="addCliente">A√±adir</button>
            </div>
            <div id="clientesList" class="grid" style="margin-top:10px"></div>
          </div>
          <div>
            <h3>Alta masiva</h3>
            <p class="hint">Pega uno por l√≠nea. Evitamos duplicados autom√°ticamente.</p>
            <textarea id="bulk"></textarea>
            <div class="row right">
              <button id="bulkAdd">A√±adir en bloque</button>
              <button id="resetClientes">Resetear a listado original</button>
            </div>
          </div>
        </div>
      </section>

      <!-- AYUDA -->
      <section id="tab-ayuda" class="hidden">
        <h3>C√≥mo usarlo</h3>
        <ol>
          <li>Elige una <strong>fecha</strong> o pulsa <em>Hoy</em>.</li>
          <li>Marca los <strong>clientes</strong> que quieras visitar ese d√≠a.</li>
          <li>Pulsa <strong>Guardar d√≠a</strong>. ¬°Listo!</li>
          <li>Para rutas fijas, edita y aplica tus <strong>R-1‚Ä¶R-5</strong> en la pesta√±a de Rutas.</li>
        </ol>
        <p class="hint">Truco: filtra por "GOIKO" y usa <em>Seleccionar todos</em> para marcar solo esos.</p>
      </section>
    </div>

    <div class="foot">
      <span>Hecho con ‚òïÔ∏è para que organizes tus rutas sin l√≠os.</span>
      <span class="muted">Datos locales ‚Ä¢ Sin conexi√≥n ‚Ä¢ 100% tuyo</span>
    </div>
  </div>

  <script>
    // ======= Semilla desde tu PDF (actualizada) =======
    var DEFAULT_CLIENTES = [
      "RTE L'ESTONETA","RTE PIPA","MARIMBA","EL PEDREGAL","LES CATIVAS","BAR RESTAURANTE POMA","A PROP TEU","TIENDA RONDA SANT ANTONI","O BURATO BAR","BAR CAFETERIA MARIANA","MANDONI PEDRALBES","TEATRO NACIONAL DE CATALUNYA","RESTAURANT CENT FOCS","HOTEL MESON CASTILLA","BAR RTE LEPANTO","CAFE ILUSIONA BY MUXIA","EL MOLI PAN Y CAFE SANTS","OMBU,RTE","DAMAIA, BAR","EXE RAMBLAS BOQUERIA","PLEASE PLATS","RESTAURANTE HONKAKU II","O CANTO RESTAURANTE","SARA TAPES","HOTEL SB GLOW","TOC HOSTAL GRAN VIA","HOTEL SB ICARIA BARCELONA","CAFETERIA DOMI","TIENDA JOAQUIM VALLS","GOIKO GRILL CARRER CAN SEGALAR","EL FOC DEN CANIGO","GOIKO GRILL GRAN VIA DE LES CORTS","LA FILOMENA BAR","GOIKO GRILL CARRER INDEPENDENCIA","GOIKO GRILL BRUC","GOIKO GRILL C.C. SOM MULTIESPAI","EUROSTARS ANGLI","BAR CA√ëAS","GOIKO GRILL PASSEIG SANT JOAN","GARBI","SETEMBRE","LA CASSOLETA","GOIKO GRILL CARRER D'ARIBAU","TIENDA TORRES I BAGES","ATICCO PASSEIG DE GR√ÄCIA CANTINA","EXE LAIETANA PALACE","TIENDA MERIDIANA II","EUROSTARS CRISTAL PALACE","RIAS DE GALICIA RTE","MIRADOR SANT JUST","IKONIK RAMBLAS","GOIKO MARAGALL","CASA DE TAPAS LA CA√ëOTA","GOIKO GRILL LAIETANA","ALTIMA HOSPITALET GRAN VIA","RINCON GALEGO","BAR EUROPA","RESTAURANTE SUKAPA","ANTOTXO","RTE ZHU ZHU","EXE PLAZA CATALUNYA 4","EUROSTARS MONUMENTAL","EUROSTARS MITRE","TIENDA SANT VICEN√á DELS HORTS","FORN VELL INDUSTRIA","FORN VELL CLARET","TIENDA VIA JULIA","VALDAURA","PIPA S CAFETERIA","RESTAURANTE LA GORMANDA","BAR BUC","TOSTA BAR","ADELITA RESTAURANTE","MOLI PAN Y CAFE ZONA FRANCA","LOKAL","BATEA","BAR LOS PINOS 2","TSUKIMI","LA PALMERA","EL MIRALL DELS ENCANTS","LOMO ALTO","HOTEL ORIENTE","HOTEL ARENAS","HOTEL TRES TORRES","ESCAIRON","LA RUTA GALLEGA","TIENDA CLOT","LA BRASA RESTAURANTE","RTE ANCARES","A DUES RODES","CAFETERIA RONDA SANT BOI","TIENDA LES CORTS","LA LLAR DEL MERCAT 2 SANT BOI","HOTEL SB WIN SANT FELIU","LOS 3 ARCOS BAR","RTE MAMETORA","BOEDO","O RINCON GALLEGO MERIDIANA","R.U. COSMOPOLITAN","FRANKFURT TOLIK","CIURIS","CAFETERIA LEROY MERLIN SANT BOI","BAR DE BO","ESCUELA JUDICIAL BCN","O MEU LAR","EL CARQUINYOLI","NON SOLO CREPS","GREENVITA NUMANCIA","K10 SUSHI SANT BOI","EL RACONET D'URGELL","TIENDA EL TALLER SANT BOI","CHALITO BCN.","HOTEL FRONTAIR CONGRESS","CLUB TIRO MONTJUIT","FRANKFURT SANTS","R.U. EMILIE DE VILLENUEVE","SOLUCIONS SOCIALS INSERCIO","ALTIMA SANT BOI","FUNDACIO ASPACE CATALUNYA","GREEN VITA GLORIES","ATICCO PASSEIG DE GR√ÄCIA OFICINA","70/30","ORDAL","PESSEBRE","BUFFS DE FARINA","TIENDA TALLER VALLDAURA","ARTESANO","HELADER√çA ADRI GELATIAMO","CUATRECASAS","SET POINT"
    ];

    // ======= Storage =======
    var LS_KEYS = { clientes:'clientes', planes:'planes', rutas:'rutasPredef' };
    function load(key, fb){ try{ var raw=localStorage.getItem(key); return raw? JSON.parse(raw) : fb; }catch(_){ return fb; } }
    function save(key, val){ try{ localStorage.setItem(key, JSON.stringify(val)); }catch(_){}}

    function dateKey(d){ return d.toISOString().slice(0,10); }
    function todayStr(){ var now=new Date(); var yyyy=now.getFullYear(); var mm=('0'+(now.getMonth()+1)).slice(-2); var dd=('0'+now.getDate()).slice(-2); return yyyy+'-'+mm+'-'+dd; }

    var CLIENTES = load(LS_KEYS.clientes, DEFAULT_CLIENTES.slice());
    var PLANES   = load(LS_KEYS.planes, {});
    var RUTAS    = load(LS_KEYS.rutas, { 'R-1':[], 'R-2':[], 'R-3':[], 'R-4':[], 'R-5':[] });

    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }

    // ======= Tabs =======
    $all('.pill').forEach(function(p){ p.addEventListener('click', function(){
      $all('.pill').forEach(function(x){ x.classList.remove('active'); });
      p.classList.add('active');
      var tab = p.getAttribute('data-tab');
      $('#tab-plan').classList.toggle('hidden', tab!=='plan');
      $('#tab-rutas').classList.toggle('hidden', tab!=='rutas');
      $('#tab-clientes').classList.toggle('hidden', tab!=='clientes');
      $('#tab-ayuda').classList.toggle('hidden', tab!=='ayuda');
      if(tab==='rutas') renderRutas();
    }); });

    // ======= Plan diario =======
    function setToday(){ $('#fecha').value = todayStr(); }
    if(!$('#fecha').value) setToday();

    function renderLista(){
      var cont = $('#lista');
      var filtro = ($('#buscador').value||'').toLowerCase();
      var key = dateKey(new Date($('#fecha').value));
      var seleccionados = new Set(PLANES[key]||[]);
      var visibles = CLIENTES.filter(function(c){ return c.toLowerCase().indexOf(filtro)!==-1; });
      cont.innerHTML = '';
      visibles.forEach(function(nombre){
        var id = 'c-'+nombre.replace(/[^a-z0-9]+/gi,'-');
        var div = document.createElement('label');
        div.className = 'item';
        div.innerHTML = '<input type="checkbox" id="'+id+'">'+
          '<div><div><strong>'+nombre+'</strong></div><div class="muted">Pulsa para incluir en el plan del d√≠a.</div></div>';
        var chk = div.querySelector('input');
        chk.checked = seleccionados.has(nombre);
        chk.addEventListener('change', function(){
          if(chk.checked){ seleccionados.add(nombre); } else { seleccionados.delete(nombre); }
          PLANES[key] = Array.from(seleccionados);
          save(LS_KEYS.planes, PLANES);
          updateToggleAll();
        });
        cont.appendChild(div);
      });
      $('#count').textContent = visibles.length + ' / ' + CLIENTES.length;
      updateToggleAll();
    }

    function updateToggleAll(){
      var key = dateKey(new Date($('#fecha').value));
      var seleccionados = new Set(PLANES[key]||[]);
      var filtro = ($('#buscador').value||'').toLowerCase();
      var visibles = CLIENTES.filter(function(c){ return c.toLowerCase().indexOf(filtro)!==-1; });
      var allSelected = visibles.length>0 && visibles.every(function(c){ return seleccionados.has(c); });
      $('#toggleAll').checked = allSelected;
    }

    $('#fecha').addEventListener('change', renderLista);
    $('#hoy').addEventListener('click', function(){ setToday(); renderLista(); });
    $('#buscador').addEventListener('input', renderLista);
    $('#clearSearch').addEventListener('click', function(){ $('#buscador').value=''; renderLista(); $('#buscador').focus(); });

    $('#toggleAll').addEventListener('change', function(e){
      var key = dateKey(new Date($('#fecha').value));
      var filtro = ($('#buscador').value||'').toLowerCase();
      var visibles = CLIENTES.filter(function(c){ return c.toLowerCase().indexOf(filtro)!==-1; });
      if(e.target.checked){
        var set = new Set(PLANES[key]||[]);
        visibles.forEach(function(v){ set.add(v); });
        PLANES[key] = Array.from(set);
      } else {
        var remain = new Set(PLANES[key]||[]);
        visibles.forEach(function(v){ remain.delete(v); });
        PLANES[key] = Array.from(remain);
      }
      save(LS_KEYS.planes, PLANES);
      renderLista();
    });

    $('#guardar').addEventListener('click', function(){ alert('¬°D√≠a guardado!'); });
    $('#vaciar').addEventListener('click', function(){
      if(confirm('¬øSeguro que quieres vaciar la selecci√≥n de este d√≠a?')){
        var key = dateKey(new Date($('#fecha').value));
        PLANES[key] = [];
        save(LS_KEYS.planes, PLANES);
        renderLista();
      }
    });
    $('#imprimir').addEventListener('click', function(){ window.print(); });

    // ======= Clientes (admin) =======
    function renderClientesAdmin(){
      var box = $('#clientesList'); box.innerHTML = '';
      CLIENTES.forEach(function(c,i){
        var row = document.createElement('div'); row.className='item';
        row.innerHTML = '<div class="grow"><strong>'+c+'</strong></div><button data-del="'+i+'">Eliminar</button>';
        row.querySelector('button').addEventListener('click', function(){
          if(confirm('¬øEliminar "'+c+'" del listado?')){
            CLIENTES.splice(i,1); save(LS_KEYS.clientes, CLIENTES); renderClientesAdmin(); renderLista();
          }
        });
        box.appendChild(row);
      });
    }

    $('#addCliente').addEventListener('click', function(){
      var v = ($('#nuevoCliente').value||'').trim(); if(!v) return;
      if(CLIENTES.indexOf(v)===-1) CLIENTES.push(v);
      CLIENTES = Array.from(new Set(CLIENTES)).sort(function(a,b){ return a.localeCompare(b); });
      save(LS_KEYS.clientes, CLIENTES);
      $('#nuevoCliente').value='';
      renderClientesAdmin();
      renderLista();
    });

    $('#bulkAdd').addEventListener('click', function(){
      var lines = ($('#bulk').value||'').split(/
?
/).map(function(s){return s.trim();}).filter(Boolean);
      if(!lines.length) return;
      CLIENTES = Array.from(new Set(CLIENTES.concat(lines))).sort(function(a,b){ return a.localeCompare(b); });
      save(LS_KEYS.clientes, CLIENTES);
      $('#bulk').value='';
      renderClientesAdmin();
      renderLista();
    });

    $('#resetClientes').addEventListener('click', function(){
      if(confirm('¬øRestablecer el listado al original?')){
        CLIENTES = DEFAULT_CLIENTES.slice(); save(LS_KEYS.clientes, CLIENTES); renderClientesAdmin(); renderLista();
      }
    });

    // ======= Rutas predefinidas =======
    function renderRutas(){
      var box = $('#rutasBox'); box.innerHTML='';
      ['R-1','R-2','R-3','R-4','R-5'].forEach(function(k){
        var arr = RUTAS[k]||[];
        var det = document.createElement('details');
        det.innerHTML = '<summary>'+k+' <span class="muted">('+arr.length+' clientes)</span></summary>'+
          '<div style="margin-top:8px">'+
          '<p class="hint">Edita (uno por l√≠nea):</p>'+
          '<textarea id="ta-'+k+'">'+arr.join('
')+'</textarea>'+
          '<div class="row right" style="margin-top:8px">'+
          '<button data-save="'+k+'">Guardar</button>'+ 
          '<button data-apply="'+k+'">Aplicar al d√≠a</button>'+ 
          '<button data-clear="'+k+'">Vaciar</button>'+ 
          '</div></div>';
        box.appendChild(det);
      });

      // Guardar
      $all('[data-save]').forEach(function(btn){ btn.addEventListener('click', function(){
        var k = btn.getAttribute('data-save');
        var ta = document.getElementById('ta-'+k);
        var lines = (ta.value||'').split(/
?
/).map(function(s){return s.trim();}).filter(Boolean);
        // quitamos duplicados y filtramos por clientes existentes
        var uniq = Array.from(new Set(lines)).filter(function(c){ return CLIENTES.indexOf(c)!==-1; });
        RUTAS[k] = uniq; save(LS_KEYS.rutas, RUTAS);
        renderRutas();
        alert('Ruta '+k+' guardada.');
      }); });

      // Aplicar
      $all('[data-apply]').forEach(function(btn){ btn.addEventListener('click', function(){
        var k = btn.getAttribute('data-apply');
        var key = dateKey(new Date($('#fecha').value));
        PLANES[key] = (RUTAS[k]||[]).slice();
        save(LS_KEYS.planes, PLANES);
        renderLista();
        alert('Ruta '+k+' aplicada al d√≠a.');
      }); });

      // Vaciar ruta
      $all('[data-clear]').forEach(function(btn){ btn.addEventListener('click', function(){
        var k = btn.getAttribute('data-clear');
        if(confirm('¬øVaciar por completo la ruta '+k+'?')){
          RUTAS[k] = []; save(LS_KEYS.rutas, RUTAS); renderRutas();
        }
      }); });
    }

    // ======= Init =======
    renderClientesAdmin();
    renderLista();
    renderRutas();
  </script>
</body>
</html>
